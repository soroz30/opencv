<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hello OpenCV.js</title>
</head>
<body>
  <div class="inputoutput">
    <img id="imageSrc" alt="No Image" />
    <div class="caption">imageSrc <input type="file" id="fileInput" name="file" /></div>
    <canvas id="canvas" width="512" height="512"></canvas>
  </div>
  <script src="opencv.js" type="text/javascript"></script>
  <script>
    let imgElement = document.getElementById("imageSrc");
    let inputElement = document.getElementById("fileInput");

    inputElement.addEventListener('change', (e) => {
      imgElement.src = URL.createObjectURL(e.target.files[0]);
    }, false);

    imgElement.onload = function() {
      let image = cv.imread(imgElement);
      let canvas = document.getElementById("canvas");

      let ctx = canvas.getContext('2d');
      let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);

      cv.cvtColor(image, image, cv.COLOR_BGR2GRAY);

      let dst = new cv.Mat();
      cv.Canny(image, dst, 0, 80);

      let contours = new cv.MatVector();
      let hierarchy = new cv.Mat();
      cv.findContours(dst, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);
      let imageContourNumber = contours.size();
      cv.imshow(canvas, dst);

      for (let i = 0; i < imageContourNumber; i++) {

        if (i == imageContourNumber) {
          continue;
        }
        let cnt = contours.get(i);
        let approx = new cv.Mat()
        cv.approxPolyDP(cnt, approx, 0.01 * cv.arcLength(cnt, true), true);
        let rows = approx.rows;

        if (rows < 4) {
          continue;
        }
        const rectData = cv.boundingRect(approx);
        const {width, height} = rectData;

        let aspectRatio = width / parseFloat(height);
        let area = cv.contourArea(cnt, false);
        let rectArea = width * height;
        let extent = area / rectArea;
        if (aspectRatio >= 1.05 && width > 10 && height > 44 && extent > 0.8) {
          console.log(extent, "  ", width)
        }
      }
    }
  </script>
</body>